/*==============================================================================
 ___  _   _    _
/   || | | |  | |
\__  | | | |  | |  __
/    |/  |/_) |/  /  \_/\/
\___/|__/| \_/|__/\__/  /\_/
              |\
              |/
Focus v1.2
https://github.com/Elkfox/Focus
Copyright (c) 2017 Elkfox Co Pty Ltd
https://elkfox.com
Project lead: George Butter
MIT License
==============================================================================*/
var Focus=function(t,e){if(this.target=t,this.element=jQuery(t),this.config={visibleClass:"visible",bodyClass:"active-popup",innerSelector:".popup-inner",popupContent:".popup-content",avoidSubpixels:!1,autoFocusSelector:"[data-auto-focus]"},e)for(var n in e)this.config[n]=e[n];this.visible=!1,this.width=jQuery(this.config.popupContent).outerWidth(),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),Focus.elements[t]=this};Focus.elements={},Focus.getTarget=function(t,e){jQuery(t).is("a")&&e.preventDefault();const n=this.getSelectorFromElement(t);return target=n?n:null,target},Focus.getSelectorFromElement=function(t){var e=jQuery(t).data("target");return e&&"#"!==e||(e=jQuery(t).attr("href")||null),e},Focus.eventHandler=function(t,e){var n=Focus.elements[t];if(!n)var n=new Focus(t);"hide"===e?n.hide():n.toggle()},Focus.prototype.verticalAlign=function(){var t=this;if(t.config.avoidSubpixels){var e=-Math.round(jQuery(this.target).find(t.config.popupContent).outerHeight()/2);jQuery(this.target).find(t.config.popupContent).css("margin-top",e).css("transform","translateY(0)")}},Focus.prototype.show=function(){var t=this;return this.visible&&this.element.hasClass(this.config.visibleClass)?jQuery(document).trigger("focus:error",{error:"Popup already open"}):(this.element.addClass(this.config.visibleClass),jQuery("body").addClass(this.config.bodyClass),this.visible=!0,t.verticalAlign(),jQuery(this.target+" "+this.config.autoFocusSelector).length&&setTimeout(function(){jQuery(t.target+" "+t.config.autoFocusSelector).focus()},300),this.element.one("click","[data-close]",function(e){e.preventDefault(),t.hide()}),this.element.one("click",this.config.innerSelector,function(e){(jQuery(e.target).is(t.config.innerSelector)||0===jQuery(e.target).parents(t.config.target).length)&&t.hide()}),this.element.on("keyup",function(e){e.preventDefault(),27===e.keyCode&&(this.element.off("keyup"),t.hide())}),jQuery(document).trigger("focus:open",[this.target]))},Focus.prototype.hide=function(){return this.visible||this.element.hasClass(this.config.visibleClass)?(this.element.removeClass(this.config.visibleClass),jQuery("body").removeClass(this.config.bodyClass),this.config.avoidSubpixels&&jQuery(this.target).find(this.config.popupContent).removeAttr("style"),this.visible=!1,jQuery(document).trigger("focus:close",[this.target])):jQuery(document).trigger("focus:error",{error:"Focus element is already closed"})},Focus.prototype.toggle=function(){return this.visible?this.hide():this.show()},jQuery(document).ready(function(){jQuery(".popup:not(.sticky)").detach().appendTo("body"),jQuery(document).on("click",'[data-trigger="popup"]',function(t){var e=Focus.getTarget(jQuery(this),t);Focus.eventHandler(e,"toggle")}),jQuery(document).on("click","[data-close]",function(t){var e=Focus.getTarget(jQuery(this),t);e&&Focus.eventHandler(e,"hide")})}),jQuery(window).resize(function(){for(var t in Focus.elements)Focus.elements[t].visible&&Focus.elements[t].verticalAlign()});
